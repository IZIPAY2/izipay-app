<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>iZiPay — Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg: #000000;
      --panel: #111111;
      --muted: #8e8e93;
      --accent: #ffffff;
      --btn-bg: #1c1c1e;
      --radius: 16px;
    }

    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: #ffffff;
      overflow-x: hidden;
    }

    /* Основной контейнер */
    .app-container {
      max-width: 480px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Верхняя часть: Баланс и Профиль */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 25px;
    }

    .balance-section {
      display: flex;
      flex-direction: column;
    }

    .balance-label {
      font-size: 18px;
      color: #ffffff;
      margin-bottom: 5px;
      font-weight: 400;
    }

    .balance-amount {
      font-size: 58px;
      font-weight: 600;
      letter-spacing: -1px;
    }

    .profile-btn {
      width: 42px;
      height: 42px;
      background: #2c2c2e;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    /* Сетка круглых кнопок */
    .action-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 40px;
    }

    .action-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }

    .circle-btn {
      width: 65px;
      height: 65px;
      background-color: var(--btn-bg);
      border-radius: 50%;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      transition: transform 0.1s, background-color 0.2s;
    }

    .circle-btn:active {
      transform: scale(0.92);
      background-color: #2c2c2e;
    }

    .circle-btn svg {
      width: 26px;
      height: 26px;
    }

    .action-label {
      font-size: 13px;
      font-weight: 500;
      color: #ffffff;
      text-align: center;
    }

    /* Карточки и инфо-блоки */
    .info-card {
      background: var(--panel);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 15px;
      border: 1px solid rgba(255,255,255,0.05);
    }

    .info-card h4 {
      margin: 0 0 10px 0;
      font-size: 15px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .info-card p {
      margin: 0;
      font-size: 17px;
      font-weight: 500;
    }

    /* Модальное окно */
    .modal-back {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: flex-end; /* Появление снизу */
      z-index: 9999;
    }

    .modal {
      width: 100%;
      max-width: 480px;
      background: #1c1c1e;
      border-radius: 25px 25px 0 0;
      padding: 25px;
      margin: 0 auto;
      animation: slideUp 0.3s ease-out;
    }

    @keyframes slideUp {
      from { transform: translateY(100%); }
      to { transform: translateY(0); }
    }

    .wallet-item {
      background: rgba(255,255,255,0.05);
      padding: 15px;
      border-radius: 15px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .copy-btn {
      background: #ffffff;
      color: #000;
      border: none;
      padding: 8px 12px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 12px;
    }

    .input-field {
      width: 100%;
      background: #2c2c2e;
      border: 1px solid #3a3a3c;
      padding: 15px;
      border-radius: 12px;
      color: #fff;
      margin: 15px 0;
      outline: none;
    }

    .main-btn {
      width: 100%;
      padding: 16px;
      background: #ffffff;
      color: #000;
      border-radius: 15px;
      border: none;
      font-weight: 700;
      font-size: 16px;
      margin-top: 10px;
    }

    .close-btn {
      background: transparent;
      color: var(--muted);
      border: none;
      width: 100%;
      padding: 10px;
      margin-top: 5px;
    }
  </style>
</head>
<body>

<div class="app-container">
  <div class="header">
    <div class="balance-section">
      <div class="balance-label">Total balance</div>
      <div class="balance-amount" id="main-balance">$93.75</div>
    </div>
    <div class="profile-btn">
      <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
      </svg>
    </div>
  </div>

  <div class="action-grid">
    <div class="action-item" onclick="openWallets('issue')">
      <button class="circle-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 5v14M5 12h14"/></svg>
      </button>
      <span class="action-label">New Card</span>
    </div>
    
    <div class="action-item" onclick="openWallets('deposit')">
      <button class="circle-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 19V5m0 14l-7-7m7 7l7-7"/></svg>
      </button>
      <span class="action-label">Receive</span>
    </div>

    <div class="action-item" onclick="openWithdraw()">
      <button class="circle-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 5v14m0-14l-7 7m7-7l7 7"/></svg>
      </button>
      <span class="action-label">Send</span>
    </div>

    <div class="action-item">
      <button class="circle-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 7h-9m3 10h5c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h2" stroke-linecap="round"/><path d="M16 12a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
      </button>
      <span class="action-label">Wallet</span>
    </div>
  </div>

  <div class="info-card">
    <h4>Active Cards</h4>
    <p id="cards-info">Virtual Card •••• 1234</p>
  </div>

  <div class="info-card">
    <h4>Recent Activity</h4>
    <p style="color: var(--muted); font-size: 14px;">No recent transactions</p>
  </div>

  <div id="uid" style="text-align: center; color: var(--muted); font-size: 12px; margin-top: 20px;">ID: Loading...</div>
</div>

<div class="modal-back" id="modal-back">
  <div class="modal" id="modal-content">
    </div>
</div>

<script>
const tg = window.Telegram?.WebApp || null;
if(tg) {
  tg.expand();
  tg.backgroundColor = '#000000';
  tg.headerColor = '#000000';
  const user = tg.initDataUnsafe?.user || {};
  document.getElementById('uid').textContent = 'User ID: ' + (user.id || 'Unknown');
}

const WALLETS = {
  "USDT (TRC-20)": "TATf7CQ6uKVrnbm8UCuXaPE5QqAmLQETXS",
  "BTC": "bc1qzut8wazg5guc3zkt557qmk0lk3e2t52r8efjr5",
  "TON": "UQDF...demo"
};

const modalBack = document.getElementById('modal-back');
const modalContent = document.getElementById('modal-content');

function openWallets(mode) {
  let title = mode === 'issue' ? 'Issue New Card' : 'Receive Crypto';
  
  modalContent.innerHTML = `
    <h3 style="margin-top:0">${title}</h3>
    <p style="color:var(--muted); font-size:14px">Select currency and copy address to deposit funds.</p>
    <div>
      ${Object.entries(WALLETS).map(([name, addr]) => `
        <div class="wallet-item">
          <div>
            <div style="font-weight:600">${name}</div>
            <div style="font-size:11px; color:var(--muted); word-break:break-all">${addr}</div>
          </div>
          <button class="copy-btn" onclick="copyText('${addr}', this)">Copy</button>
        </div>
      `).join('')}
    </div>
    <button class="main-btn" onclick="sendSignal('paid')">I have paid</button>
    <button class="close-btn" onclick="closeModal()">Dismiss</button>
  `;
  modalBack.style.display = 'flex';
}

function openWithdraw() {
  modalContent.innerHTML = `
    <h3 style="margin-top:0">Send Crypto</h3>
    <p style="color:var(--muted); font-size:14px">Enter the destination address and amount.</p>
    <input type="text" class="input-field" placeholder="Wallet Address" id="withdraw-addr">
    <input type="number" class="input-field" placeholder="Amount ($)" id="withdraw-amount">
    <button class="main-btn" onclick="sendSignal('withdraw')">Send Funds</button>
    <button class="close-btn" onclick="closeModal()">Cancel</button>
  `;
  modalBack.style.display = 'flex';
}

function closeModal() {
  modalBack.style.display = 'none';
}

async function copyText(text, btn) {
  await navigator.clipboard.writeText(text);
  const original = btn.textContent;
  btn.textContent = 'Copied!';
  btn.style.background = '#34c759';
  setTimeout(() => { 
    btn.textContent = original; 
    btn.style.background = '#ffffff';
  }, 1500);
}

function sendSignal(action) {
  if(tg) {
    tg.sendData(JSON.stringify({action: action, timestamp: Date.now()}));
  }
  alert('Request sent to admin');
  closeModal();
}

// Close on outside click
modalBack.onclick = (e) => { if(e.target === modalBack) closeModal(); };
</script>

</body>
</html>