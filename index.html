<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>iZiPay Dashboard</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #0f1115;
      --card-bg: #1a1d24;
      --primary-green: #638576;
      --text-white: #ffffff;
      --text-gray: #9ca3af;
      --border-glass: rgba(255, 255, 255, 0.08);
      --glass-surface: rgba(255, 255, 255, 0.03);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
    
    body { background: var(--bg-dark); color: var(--text-white); padding: 20px; }

    /* Хедер */
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    .logo-text { font-size: 20px; font-weight: 700; letter-spacing: -0.5px; }

    /* Баланс */
    .balance-section { text-align: center; margin-bottom: 30px; }
    .currency { font-size: 14px; color: var(--text-gray); text-transform: uppercase; letter-spacing: 1px; }
    .balance-amount { font-size: 42px; font-weight: 700; background: linear-gradient(180deg, #fff 0%, #aaa 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

    /* Кнопки действий */
    .card-actions { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 30px; }
    .action-btn { background: var(--card-bg); border: 1px solid var(--border-glass); border-radius: 14px; padding: 12px 5px; display: flex; flex-direction: column; align-items: center; gap: 6px; cursor: pointer; color: white; transition: 0.2s; text-decoration: none; }
    .action-btn i { font-size: 22px; color: var(--primary-green); }
    .action-btn span { font-size: 10px; font-weight: 500; }

    /* Карта */
    .card-visual-wrapper { width: 100%; border-radius: 20px; overflow: hidden; margin-bottom: 15px; border: none; /* Убрали обводку */ box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .card-image { width: 100%; display: block; border-radius: 20px; }

    /* Инфо-бокс с номером */
    .card-info-box { background: var(--card-bg); border: 1px solid var(--border-glass); border-radius: 16px; padding: 16px 20px; margin-bottom: 10px; }
    .card-number-row { display: flex; justify-content: space-between; align-items: center; }
    .card-number-text { font-family: monospace; font-size: 18px; letter-spacing: 2px; color: var(--text-white); }
    .copy-icon { color: var(--primary-green); cursor: pointer; padding: 5px; }

    /* Кнопка деталей */
    .toggle-details-btn { width: 100%; background: var(--glass-surface); border: none; color: var(--primary-green); padding: 12px; border-radius: 12px; font-size: 13px; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }

    /* Скрытые детали */
    .card-details { margin-top: 10px; background: var(--glass-surface); border-radius: 12px; padding: 0 15px; display: none; }
    .card-details.active { display: block; }
    .detail-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 13px; }
    .detail-row:last-child { border-bottom: none; }
    .detail-label { color: var(--text-gray); }
    .detail-value { font-weight: 600; }

    #loader { position: fixed; inset: 0; background: var(--bg-dark); display: flex; align-items: center; justify-content: center; z-index: 1000; }
  </style>
</head>
<body>
<div id="loader">IZIPAY...</div>

<header class="header">
  <div class="logo-text">IZIPAY</div>
  <i class="ri-user-line" style="font-size: 24px;"></i>
</header>

<div class="balance-section">
  <div class="currency">Total Balance</div>
  <div class="balance-amount" id="user-balance">$0.00</div>
</div>

<div class="card-actions">
  <div class="action-btn"><i class="ri-add-circle-fill"></i><span>Top Up</span></div>
  <div class="action-btn"><i class="ri-arrow-up-circle-fill"></i><span>Withdraw</span></div>
  <div class="action-btn"><i class="ri-time-fill"></i><span>History</span></div>
  <div class="action-btn" onclick="requestCard()"><i class="ri-bank-card-fill"></i><span>New Card</span></div>
</div>

<div id="card-section" style="display: none;">
  <div class="card-visual-wrapper">
    <img src="metalwhitecard.png" class="card-image" alt="Card">
  </div>

  <div class="card-info-box">
    <div class="card-number-row">
      <span class="card-number-text" id="card-num-display">**** **** **** ****</span>
      <i class="ri-file-copy-line copy-icon" onclick="copyCard()"></i>
    </div>
  </div>

  <button class="toggle-details-btn" id="toggleBtn" onclick="toggleDetails()">
    <i class="ri-eye-line"></i> View Card Details
  </button>

  <div class="card-details" id="cardDetails">
    <div class="detail-row"><span class="detail-label">CVV</span><span class="detail-value" id="card-cvv-display">***</span></div>
    <div class="detail-row"><span class="detail-label">Expiry</span><span class="detail-value" id="card-exp-display">--/--</span></div>
    <div class="detail-row"><span class="detail-label">Status</span><span class="detail-value" style="color: #10b981;">Active</span></div>
  </div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBTpsS1kStrz8EA1EO0F4v3YkdENnxGHsM",
    authDomain: "izipay-f1def.firebaseapp.com",
    databaseURL: "https://izipay-f1def-default-rtdb.firebaseio.com",
    projectId: "izipay-f1def"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const tg = window.Telegram.WebApp;
  tg.expand();

  const userId = tg.initDataUnsafe?.user?.id || "7897252945";

  db.ref('users/' + userId).on('value', (snapshot) => {
    document.getElementById('loader').style.display = 'none';
    const data = snapshot.val();
    
    if (data) {
      document.getElementById('user-balance').textContent = '$' + (data.balance || 0).toLocaleString(undefined, {minimumFractionDigits: 2});
      
      if (data.status === "active" || data.status === "pending") {
        document.getElementById('card-section').style.display = 'block';
        document.getElementById('card-num-display').textContent = data.card_num || "**** **** **** ****";
        document.getElementById('card-cvv-display').textContent = data.cvv || "***";
        document.getElementById('card-exp-display').textContent = data.exp || "--/--";
      }
    }
  });

  function toggleDetails() {
    const details = document.getElementById('cardDetails');
    const btn = document.getElementById('toggleBtn');
    details.classList.toggle('active');
    if(details.classList.contains('active')) {
      btn.innerHTML = '<i class="ri-eye-off-line"></i> Hide Details';
    } else {
      btn.innerHTML = '<i class="ri-eye-line"></i> View Card Details';
    }
  }

  function copyCard() {
    const num = document.getElementById('card-num-display').textContent;
    navigator.clipboard.writeText(num);
    tg.HapticFeedback.notificationOccurred('success');
  }

  function requestCard() {
    db.ref('users/' + userId).update({ status: "pending" });
    tg.showAlert("Application sent! Admin will issue your card soon.");
  }
</script>
</body>
</html>
